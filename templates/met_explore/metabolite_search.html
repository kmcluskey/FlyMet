{% extends 'base.html' %}
{% load static %}
{% load render_bundle from webpack_loader %}
{% block title %} Search Metabolites {% endblock %}

{% block head_block %}
    {% render_bundle 'metabolite_search' 'css' %}
{% endblock %}

{% block body_block %}

  <!-- div for main body-->
  <div class="container-fluid p-4">

    <div>
      <p class="mt-2 lead">
        Choose to search for <i> Drosophila </i> enzymes, metabolites, pathways or tissue-types:
      </p>
    </div>

    <!--Tabs to go to new pages-->
    <div class="card text-center">
      <div class="card-header">
        <ul class="nav nav-tabs card-header-tabs">
          <li class="nav-item">
            <a class="nav-link" href="{% url 'enzyme_search' %}">Enzymes</a>
          </li>
          <li class="nav-item">
            <a class="nav-link active" href="{% url 'metabolite_search' %}">Metabolites</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="{% url 'pathway_search' %}">Pathways</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="{% url 'tissue_search' %}">Tissues</a>
          </li>
        </ul>
      </div>
    </div>

    <!--Search info and box-->
    <div>
      <p class="mt-4 mb-1" >
        Search for a <b>metabolite</b> and find out the abundance in <i> Drosophila </i> tissues:
      </p>
    </div>

    <form action="metabolite_search" method="get" class="form-inline my-2 my-lg-0">
      <input id = "metabolite_search" name ='metabolite_search' class="form-control mr-sm-2" type="text" placeholder="Metabolite Search">
      <button class="btn btn-outline-primary my-2 my-sm-0" type="submit">Search</button>
    </form>

    <!--Div for a single table-->
    {% if metabolite|length > 0 %}
    <div class="card mt-4 p-2 pb-2 border border-table rounded">

      {% if met_table_data|length == 0%}
      <div class="card-header pb-0 table-card-header">
      {{metabolite}} is not an identified metabolite, please search again.
      </div>
      {% endif %}

      {% if met_table_data|length > 0 %}
      <div class="card-header pb-0 table-card-header">
      {{metabolite}} levels in <i> Drosophila </i> tissues
      </div>
      <div class="container-fluid pb-0" >
        <div class="row pb-0">
          <div class="myspan75 p-2 mt-2">

            <table id="tissue_met_table" class="table-sm table-bordered table-hover table-striped dt-responsive nowrap" style="width:100%">
              <thead class="thead-light">
                <tr>
                  <th class="data">Tissue-Type</th>
                  <th class="AM_met_WT_ratio data">Adult Male FC</th>
                  <th class="AF_met_WT_ratio data">Adult Female FC</th>
                  <th class="L_met_WT_ratio data">Larvae FC</th>
                </tr>
              </thead>
              <tbody>
                {% for met_exp_data in met_table_data %}
                <tr>
                      {% for m in met_exp_data %}
                      {% if forloop.first %}
                        <td>{{m}}</td>
                      {% else %}
                        <td>{{m|stringformat:".2f"}}</td>
                      {% endif %}
                  {% endfor %}
                </tr>
                {% endfor %}
              </tbody>
            </table>

            <!--Bottom infopanel Div-->
            <fieldset class="fieldset-details">
              <legend>Pathways containing {{metabolite}} </legend>
              <div class="p-2">
                <ul>
                  <li><a href="../html/pathways_index.html">{{metabolite}} catabolism</a>
                    <p class="m-2">This event has been computationally inferred from an event that has been demonstrated in another species.</p>
                  </li>
                  <li><a href="#!">Histidine, lysine, phenylalanine, tyrosine, proline and tryptophan catabolism</a>
                    <p class="m-2">This event has been computationally inferred from an event that has been demonstrated in another species.</p>
                  </li>

                  <li><a href="#!">Synthesis of diphthamide-EEF2</a>
                    <p class="m-2">This event has been computationally inferred from an event that has been demonstrated in another species.</p>
                  </li>

                </ul>

              </div>
            </fieldset>
          </div>
          <!-- End of main div myspan75 -->

          <div class="myspan25 pl-2 pr-2 pt-2" style="height:100vh; overflow:scroll">
            <fieldset class="fieldset-details">
              <legend class="sidebar"><a data-toggle="modal" href="#cmpd_Modal">{{metabolite}}</a></legend>

              <div class="container-fluid">
                <div class="row">
                  <div class="mol_span50_L">

                      {% if kegg_id is not None %}
                      <a href="https://www.genome.jp/dbget-bin/www_bget?{{kegg_id}}">
                      <img class="molecule_image float-left" src="https://www.genome.jp/Fig/compound/{{kegg_id}}.gif" alt="Logo"></a>
                      {% elif kegg_id is None %}
                      <a href="https://www.ebi.ac.uk/chebi/searchId.do?chebiId=CHEBI:27570">
                      <img class="molecule_image float-left" src="{% static 'images/awaiting_image.png'%}"" alt="Waiting"></a>
                      {% endif %}
                    </div>
                    <div class = "mol_span50_R pl-2 molecule_div">
                      <ul class="molecule_list pl-2">
                        <li class="pb-2"><u>Formula:</u> C<sub>6</sub>H<sub>9</sub>N<sub>3</sub>O<sub>2</sub></li>
                        <li class="pb-2"><u>Av Mass:</u> 155.15468</li>
                        <li class="pb-2"><u>MI Mass:</u> 155.069</li>
                      </ul>

                    </div>
                  </div>
                </div>
              </fieldset>

              <fieldset id="click_info" class="fieldset-details">
                <div class="p-2">
                  <p class="m-2">Click on a tissue-type to see the intensities of the peaks associated with Histidine</p>
                </div>
              </fieldset>

              <!-- </divs> for the peak data and graphs-->
              <fieldset class="peak_details fieldset-details">
                <legend class="sidebar">Peak 1</legend>
                <div class="p-2">
                  <span id="I" class="badge badge-pill badge-success">I</span>
                  <span id ="F" class="badge badge-pill badge-primary">F</span>
                  <span id="A" class="badge badge-pill badge-warning">A15</span>
                  <hr>
                  <div class="row">
                    <div class="col-sm-4 peak_data"><u>Ion:</u> M+H</div><div class="col-sm-4 peak_data"><u>Mass:</u> 156.0769</div>
                    <div class="col-sm-4 peak_data"><u>RT:</u> 854.86 </div>
                  </div>
                </div>
                <div class="p-2">
                  <p id="tissue_type1"></p>
                </div>
                <div id="highchart" class="p-4">
                </div>
              </fieldset>

              <fieldset class="peak_details fieldset-details">
                <legend class="sidebar">Peak 2</legend>
                <div class="p-2">
                  <span id="I2" class="badge badge-pill badge-success">I</span>
                  <span id ="F1" class="badge badge-pill badge-primary">F</span>
                  <span id="A1" class="badge badge-pill badge-warning">A4</span>
                  <hr>
                  <div class="row">
                    <div class="col-sm-4 peak_data"><u>Ion:</u> M-H</div><div class="col-sm-4 peak_data"><u>Mass:</u> 154.0623</div>
                    <div class="col-sm-4 peak_data"><u>RT:</u> 704.74 </div>
                  </div>
                </div>
                <div class="p-2">
                  <p id="tissue_type2"></p>
                </div>
                <div id="highchart1" class="p-4">
                </div>
              </fieldset>

              <fieldset class="peak_details fieldset-details ">
                <legend class="sidebar">Peak 3</legend>
                <div class="p-2">
                  <span id ="F0" class="badge badge-pill badge-danger">F</span>
                  <span id="A2" class="badge badge-pill badge-warning">A47</span>
                  <hr>
                  <div class="row">
                    <div class="col-sm-4 peak_data"><u>Ion:</u> M-H</div><div class="col-sm-4 peak_data"><u>Mass:</u> 154.0623</div>
                    <div class="col-sm-4 peak_data"><u>RT:</u> 1055.4 </div>
                  </div>
                </div>
                <div class="p-2">
                  <p id="tissue_type3"></p>
                </div>
                <div id="highchart2" class="p-4">
                </div>
              </fieldset>

            </div>
            <!-- End of side bar divs -->
          </div>
        </div>
        {% endif %}
        {% endif %}

      </div>

    </div>

    <!--end of main div-->
    <!--Footer end-->

    <!-- The Modal -->
<div class="modal" id="cmpd_Modal">
  <div class="modal-dialog">
    <div class="modal-content">

      <!-- Modal Header -->
      <div class="modal-header">
        <h5 class="modal-title">L-Histidine Cross References:</h5>
        <button type="button" class="close" data-dismiss="modal">&times;</button>
      </div>

      <!-- Modal body -->
      <div class="modal-body row">
        <div class="col-sm-12">
          <h6> DB Identifiers: </h6>
          <ul>
            <li> <span class= "modal_list_items">ChEBI:</span> <a href="https://www.ebi.ac.uk/chebi/searchId.do?chebiId=CHEBI:15971" class="tab">15971</a></li>
            <li><span class= "modal_list_items">Kegg:</span> <a href="https://www.genome.jp/dbget-bin/www_bget?C00135" class="tab" >C00135</a></li>
            <li><span class= "modal_list_items">ChemSpider:</span> <a href="http://www.chemspider.com/Chemical-Structure.6038.html" class="tab">6038</a></li>
            <li><span class= "modal_list_items">HMDB:</span> <a href="http://www.hmdb.ca/metabolites/HMDB0000177" class="tab" >HMDB0000177</a></li>
          </ul>
        <!-- </div> -->
        <!-- <div class="col-md-6"> -->

          <h6>Universal Identifiers: </h6>
          <ul >
            <li> <span class= "modal_list_items">InChIKey: </span><span class="tab">HNDVDQJCIGZPNO-YFKPBYRVSA-N</span></li>
            <li> <span class= "modal_list_items">Smiles: </span><span class="tab">N[C@@H](CC1=CN=CN1)C(O)=O</span></li>
            <li> <span class= "modal_list_items">IUPAC: </span><span class="tab">L-Histidine</span></li>
          </ul>
        </div>
      <!-- </div> -->
      </div>

      <!-- Modal footer -->
      <div class="modal-footer">
        <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
      </div>

    </div>
  </div>
</div>

{% endblock %}

  {% block js_block %}

  <script type='text/javascript'>

    var metabolite ="{{metabolite}}"

      var min = {{min}}
      var max = {{max}}
      var mid = {{mean}}

    console.log("using values", min, mid, max, metabolite)
  </script>

    {% render_bundle 'metabolite_search' 'js' %}
{% endblock %}
